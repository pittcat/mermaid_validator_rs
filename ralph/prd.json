{
  "project": "Mermaid Validator Rust 重写",
  "branchName": "ralph/mermaid-validator-rust-rewrite",
  "description": "使用 mmdr 以 Rust 重写 Mermaid Validator，同时保持 validateMermaid 工具与现有 TypeScript 行为兼容。",
  "userStories": [
    {
      "id": "US-001",
      "title": "创建 Rust crate 骨架与基础依赖",
      "description": "作为开发者，我希望有一个包含核心依赖的 Rust crate 骨架，以便项目可以编译和运行。",
      "acceptanceCriteria": [
        "在 Cargo.toml 添加依赖: rmcp, tokio, serde, base64, thiserror",
        "创建 src/main.rs 与 src/lib.rs，保持最小可编译设置",
        "cargo check 退出码为 0",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "启动 MCP 服务器并提供 validateMermaid 桩实现",
      "description": "作为开发者，我希望 MCP 服务器能启动并暴露 validateMermaid，这样工具链路端到端打通。",
      "acceptanceCriteria": [
        "MCP 工具列表包含 validateMermaid",
        "validateMermaid 被调用时返回固定的占位响应",
        "cargo run 启动服务器无错误",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "通过 mmdr 渲染 Mermaid 为 SVG",
      "description": "作为开发者，我希望调用 mmdr 渲染 SVG 输出，以便 validateMermaid 能返回 SVG 结果。",
      "acceptanceCriteria": [
        "cli runner 写入临时 .mmd 文件并调用 mmdr 生成 SVG 文件",
        "读取 SVG 输出且包含 <svg 头",
        "cargo test -p mermaid_validator -- tests::render_svg 退出码为 0",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "默认渲染 Mermaid 为 PNG",
      "description": "作为开发者，我希望 PNG 渲染作为默认输出，以便工具与 TS 行为一致。",
      "acceptanceCriteria": [
        "cli runner 可通过 mmdr 输出 PNG 并读取文件为字节",
        "validateMermaid 默认格式返回 mimeType image/png",
        "cargo test -p mermaid_validator -- tests::render_png 退出码为 0",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "错误映射与 TS 输出结构对齐",
      "description": "作为开发者，我希望错误响应与 TS 格式一致，便于客户端统一处理。",
      "acceptanceCriteria": [
        "无效图表响应包含预期的错误结构与字段",
        "标准化 invalid/error 响应形状与 TS 行为一致",
        "cargo test -p mermaid_validator -- tests::invalid_diagram 退出码为 0",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "添加渲染超时控制",
      "description": "作为开发者，我希望有可配置的渲染超时，避免大图无限阻塞服务器。",
      "acceptanceCriteria": [
        "MERMAID_TIMEOUT 环境变量控制渲染超时长度",
        "超时返回可识别的错误响应",
        "cargo test -p mermaid_validator -- tests::timeout_handling 退出码为 0",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "补充核心测试覆盖",
      "description": "作为开发者，我希望覆盖 svg/png/invalid/timeout 路径的测试，保证行为可验证。",
      "acceptanceCriteria": [
        "添加覆盖 svg、png、无效图表、超时场景的测试",
        "cargo test 退出码为 0",
        "Tests pass",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "更新 README 与文档以匹配 Rust 流程",
      "description": "作为开发者，我希望文档描述 Rust 用法与 mmdr 依赖，以便清晰配置。",
      "acceptanceCriteria": [
        "README 移除 npm 分发说明",
        "README 记录 cargo build/run 与 cargo install --path .",
        "README 说明本地 mmdr 依赖与支持平台",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "完善 cargo install 分发流程",
      "description": "作为开发者，我希望有清晰且可用的 cargo install 流程，便于分发。",
      "acceptanceCriteria": [
        "Cargo 元数据足以让 cargo install --path . 成功",
        "cargo install --path . 退出码为 0",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    }
  ]
}
